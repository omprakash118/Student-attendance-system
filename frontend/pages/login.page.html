<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mark Me - Student Management System</title>
 <link rel="shortcut icon" href="../assets/mendeley-brands.svg" type="image/x-icon">
  <link rel="stylesheet" href="../src/input.css">
  <link rel="stylesheet" href="../src/output.css">
  <link rel="stylesheet" href="../styles/adminCss.css">
  <script src="https://kit.fontawesome.com/a9bed58581.js" crossorigin="anonymous"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100..900;1,100..900&family=Rubik+Wet+Paint&display=swap" rel="stylesheet">
  <style>

    :root {
      --primary: #415a77;
      --primary-dark: #334151;
      --secondary: #f3f4f6;
      --text-primary: #111827;
      --text-secondary: #4b5563;
      --bg-overlay: rgba(255, 255, 255, 0.85);
      --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    
    body {
      font-family: 'Exo 2', sans-serif;
      margin: 0;
      padding: 0;
    }
    
    .backMe {
      background-image: url('../assets/ai-generated-8829721_1920.jpg');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      position: relative;
    }
    
    .backMe::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(13, 27, 42, 0.7) 0%, rgba(65, 90, 119, 0.7) 100%);
    }
    
    .logoname {
      font-family: 'Exo 2', sans-serif;
      font-weight: 800;
      background: linear-gradient(45deg, #415a77, #2c5584);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      letter-spacing: 0.05em;
    }
    
    .login-container {
      background: var(--bg-overlay);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255, 255, 255, 0.18);
      padding: 2.5rem;
      width: 100%;
      max-width: 450px;
      position: relative;
      overflow: hidden;
    }
    
    .login-container::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #1b263b, #415a77, #778da9);
    }
    
    .form-input {
      width: 100%;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      background: rgba(255, 255, 255, 0.5);
      font-size: 1rem;
      transition: all 0.3s ease;
    }
    
    .form-input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(26, 86, 219, 0.15);
      outline: none;
    }
    
    .form-select {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
      background-position: right 0.5rem center;
      background-repeat: no-repeat;
      background-size: 1.5em 1.5em;
      padding-right: 2.5rem;
      appearance: none;
    }
    
    .btn {
      width: 100%;
      padding: 0.75rem;
      font-size: 1rem;
      font-weight: 600;
      border-radius: 8px;
      transition: all 0.3s ease;
      cursor: pointer;
      border: none;
    }
    
    .btn-primary {
      background: linear-gradient(to right, var(--primary), var(--primary-dark));
      color: white;
      box-shadow: 0 4px 6px -1px rgba(26, 86, 219, 0.1), 0 2px 4px -1px rgba(26, 86, 219, 0.06);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgba(26, 86, 219, 0.1), 0 4px 6px -2px rgba(26, 86, 219, 0.05);
    }
    
    .btn-primary:active {
      transform: scale(0.98);
    }
    
    .btn-secondary {
      background: #f3f4f6;
      color: #4b5563;
      border: 1px solid #d1d5db;
    }
    
    .btn-secondary:hover {
      background: #e5e7eb;
    }
    
    .captcha-container {
      background: linear-gradient(to right, #f3f4f6, #e5e7eb);
      border-radius: 8px;
      font-weight: 600;
      color: #374151;
      letter-spacing: 2px;
      text-shadow: 1px 1px 1px rgba(255, 255, 255, 0.5);
      position: relative;
      overflow: hidden;
    }
    
    .captcha-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%239C92AC' fill-opacity='0.1'/%3E%3C/svg%3E");
      opacity: 0.3;
    }
    
    .form-group {
      position: relative;
      margin-bottom: 1.25rem;
    }
    
    .form-icon {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      left: 1rem;
      color: #6b7280;
    }
    
    .icon-input {
      padding-left: 2.75rem;
    }
    
    .pulse-animation {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
      100% {
        transform: scale(1);
      }
    }
  </style>
</head>

<body>
  <div id="login">
    <div class="backMe flex min-h-screen items-center justify-center p-4">
      <div class="login-container w-full max-w-md rounded-lg p-8 shadow-md">
        <div class="mb-8 flex flex-col items-center text-[#1b263b]">
          <!-- Title -->
          <div class="text-center flex justify-center items-center gap-4 mb-4 pulse-animation">
            <div class="text-6xl">
              <i class="fa-brands fa-mendeley text-[#1b263b]"></i>
            </div>
            <h1 class="text-4xl font-semibold logoname font">Mark Me</h1>
          </div>
          <h2 class="mt-1 text-xl font-medium text-[#415a77]">Online Attendance System</h2>
        </div>

        <!-- Login Form -->
        <form id="loginForm" class="space-y-5 text-xl">
          <h3 class="mb-6 font-bold text-center text-[#1b263b] text-2xl">Login to Your Account</h3>

          <!-- Email -->
          <div class="form-group">
            <span class="form-icon"><i class="fas fa-envelope"></i></span>
            <input type="text" id="email" name="email" placeholder="Email" required
              class="form-input icon-input w-full rounded border border-gray-700 px-4 py-2 focus:border-transparent focus:ring-2 focus:ring-[#415a77] focus:outline-none" />
          </div>

          <!-- Username -->
          <div class="form-group">
            <span class="form-icon"><i class="fas fa-user"></i></span>
            <input type="text" id="username" name="username" placeholder="Username" required
              class="form-input icon-input w-full rounded border border-gray-700 px-4 py-2 focus:border-transparent focus:ring-2 focus:ring-[#415a77] focus:outline-none" />
          </div>

          <!-- Password -->
          <div class="form-group">
            <span class="form-icon"><i class="fas fa-lock"></i></span>
            <input type="password" id="password" name="password" placeholder="Password" required
              class="form-input icon-input w-full rounded border border-gray-700 px-4 py-2 focus:border-transparent focus:ring-2 focus:ring-[#415a77] focus:outline-none" />
          </div>

          
          <!-- User Type -->
          <div class="form-group">
            <span class="form-icon"><i class="fas fa-user-tag"></i></span>
            <select id="userType" name="userType" required
              class="form-input icon-input form-select w-full rounded border  border-gray-700 px-4 py-2 text-gray-700 focus:border-transparent focus:ring-2 focus:ring-[#415a77] focus:outline-none">
              <option value="" disabled selected>Select User Type</option>
              <option value="admin">Admin</option>
              <option value="teacher">Teacher</option>
              <option value="student">Student</option>
            </select>
          </div>

          <!-- Captcha -->
          <!-- <div class="flex space-x-3">
            <div class="captcha-container flex w-1/3 items-center justify-center rounded px-4 py-3">
              <span class="font-medium text-[#415a77]">997087</span>
            </div>
            <div class="w-2/3 relative">
              <span class="form-icon"><i class="fas fa-shield-alt"></i></span>
              <input type="text" id="captcha" name="captcha" placeholder="Enter Captcha" required
                class="form-input icon-input w-full rounded border border-gray-700 px-4 py-2 focus:border-transparent focus:ring-2 focus:ring-[#415a77] focus:outline-none" />
            </div>
          </div> -->
          <!-- Captcha -->
         
            <!-- <div class="captcha-container flex w-1/3 items-center justify-center rounded px-4 py-3">
              <span class="font-medium text-[#415a77]">997087</span>
            </div>
            <div class="w-2/3 relative">
              <span class="form-icon"><i class="fas fa-shield-alt"></i></span>
              <input type="text" id="captcha" name="captcha" placeholder="Enter Captcha" required
                class="form-input icon-input w-full rounded border border-gray-700 px-4 py-2 focus:border-transparent focus:ring-2 focus:ring-[#415a77] focus:outline-none" />
            </div> -->

<div class="flex justify-center items-center">

  <div class="captcha-container  items-center justify-center rounded px-4 py-3 w-[80%]">
    <p id="captchaQuestion" class="font-medium text-[#415a77]"></p>
  </div>

   
            <div class="w-2/3 relative">
              <span class="form-icon"><i class="fas fa-shield-alt"></i></span>
              <input type="number" id="captcha" name="captchaAnswer" placeholder="Enter Captcha" required
              class="form-input icon-input w-full rounded border border-gray-700 px-4 py-2 focus:border-transparent focus:ring-2 focus:ring-[#415a77] focus:outline-none" />
            </div>
            <input type="hidden" id="captchaExpected" name="captchaExpected" />
            
          </div>

          <!-- Buttons -->
          <div class="grid grid-cols-2 gap-4 pt-4">
            <button type="submit"
              class="btn btn-primary cursor-pointer rounded-md border-none bg-[#415a77] px-4 py-2 text-[#e0e1dd] transition duration-300 hover:bg-[#778da944] hover:text-[#0d1b2a] active:scale-95 active:bg-[#415a77]">
              <i class="fas fa-sign-in-alt mr-2"></i> Login
            </button>
            <button type="reset"
              class="btn btn-secondary cursor-pointer rounded-md border-none bg-[#415a77] px-4 py-2 text-[#e0e1dd] transition duration-300 hover:bg-[#778da944] hover:text-[#0d1b2a] active:scale-95 active:bg-[#415a77]">
              <i class="fas fa-times mr-2"></i> Cancel
            </button>
          </div>

          <!-- <div class="text-center text-sm text-gray-600 mt-4">
            <p>Having trouble logging in? <a href="#" class="text-blue-600 hover:underline">Contact Support</a></p>
          </div> -->
        </form>
      </div>
    </div>
  </div>

  <!-- login.page.html -->
  <script>
    document.getElementById('loginForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const email = document.getElementById('email').value;
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const role = document.getElementById('userType').value;
      const userCaptchaAnswer = parseInt(document.getElementById('captcha').value, 10);
      const expectedCaptcha = parseInt(document.getElementById('captchaExpected').value, 10);

      if (userCaptchaAnswer !== expectedCaptcha) {
        alert('Invalid captcha answer! Please try again.');
        generateCaptcha(); 
        return;
      }
      try {
        const res = await fetch('http://localhost:8000/api/user/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ email, username, password, role })
        });
        const data = await res.json();
        console.log("login data", data);
        if (res.ok) {
          alert(data.message || 'Login successful!');
          console.log('First Name:', data.data.user.Firstname); // Check first name
          // Store userId in localStorage
          localStorage.setItem('userId', data.data.userId);
          localStorage.setItem('userRole', data.data.userRole);
          localStorage.setItem("userName", data.data.user.Firstname + " " + data.data.user.Lastname);

          if (role === 'teacher') {
            localStorage.setItem('teacher', JSON.stringify(data.data));
          }

          // Redirect to appropriate page based on role
          if (role === 'admin') {
            window.location.href = '/frontend/pages/admin.page.html';
          } else if (role === 'teacher') {
            window.location.href = '/frontend/pages/teacher.page.html';
          } else if (role === 'student') {
            window.location.href = '/frontend/pages/student.page.html';
          }
        } else {
          alert(data.message || 'Login failed!');
        }
      } catch (error) {
        console.error('Login error:', error);
        alert('Server error. Please try again.');
      }
    });
  </script>

  <script>
    // In your HTML page script
  function generateCaptcha() {
  const num1 = Math.floor(Math.random() * 10) + 1;
  const num2 = Math.floor(Math.random() * 10) + 1;
  const question = `${num1} + ${num2} = ?`;
  const expected = num1 + num2;

  document.getElementById('captchaQuestion').textContent = question;
  document.getElementById('captchaExpected').value = expected;
}

// Call the function to generate a captcha when the page loads
window.onload = generateCaptcha;
  </script>
</body>

</html>